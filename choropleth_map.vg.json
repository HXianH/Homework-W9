{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Blood Donations by State in Malaysia",
    "fontSize": 30,
    "font": "Serif"
  },
  "width": 1400,
  "height": 600, 
  "projection": {"type": "equalEarth"},
  "layer" : [
    {
      "mark": {
        "type": "rect",
        "stroke": "lightgray",
        "strokeWidth": 1
      },
      "data": {
        "sequence": {
          "start": -10,
          "stop": 180,
          "step": 100
        }
      },
      "encoding": {
        "x": {"field": "data", "type": "quantitative", "scale": {"domain": [-180, 180]}, "axis": {"grid": true, "labels": false, "ticks": false, "title": null, "domain": false}},
        "y": {"field": "data", "type": "quantitative", "scale": {"domain": [-90, 90]}, "axis": {"grid": true, "labels": false, "ticks": false, "title": null, "domain": false}},
        "x2": {"field": "data", "offset": 100},
        "y2": {"field": "data", "offset": 100},
        "color": {"value": "transparent"}
      }
    },
    {
      "data": {
      "url": "https://raw.githubusercontent.com/HXianH/FIT3179/main/Homework%20W9/malaysia-states.topojson", 
      "format": {"type": "topojson", "feature": "states"} 
      },
      "transform": [   
        {
          "lookup": "properties.Name",  
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/HXianH/FIT3179/main/Homework%20W9/data/normalized_blood_donors_by_year.csv",
              "format": {"type": "csv"}
            },
            "key": "state", 
            "fields": ["donations", "year"]
          }
        },
        {
          "calculate": "'Data is not available in ' + datum.properties.Name", 
          "as": "note"
        }
      ],
      "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "black"},
      "encoding": {
        "tooltip": {
          "field": "note"
        }
      }
    },
    {
      "data": {
      "url": "https://raw.githubusercontent.com/HXianH/FIT3179/main/Homework%20W9/malaysia-states.topojson", 
      "format": {"type": "topojson", "feature": "states"} 
      },
      "transform": [   
        {
          "lookup": "properties.Name",  
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/HXianH/FIT3179/main/Homework%20W9/data/normalized_blood_donors_by_year.csv",
              "format": {"type": "csv"}, 
              "transform": [{"filter": "datum.year == '2024'"}]
            },
            "key": "state", 
            "fields": ["donations", "year"]
          }
        },
        {
          "calculate": "datum.donations == null ? null : (toNumber(datum.donations) / 10000)",
          "as": "donations_num"
        }
      ],
      "mark": {"type": "geoshape", "stroke": "black"},
      "encoding": {
        "color": {
          "field": "donations_num",
          "type": "quantitative",
          "title": "Blood Donations"
        },
        "tooltip": [
          {"field": "year", "type": "nominal", "title": "Year"},
          {"field": "properties.Name", "type": "nominal", "title": "State"},
          {"field": "donations_num", "type": "quantitative", "title": "Donations per 10,000 people"}
        ]
      }
    }
  ]
}
  
